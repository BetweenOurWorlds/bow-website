---
layout: default
id: tools
---
<div>
  <h2>Tools</h2>

  <div id="tools" class="text">
    <div id="reverse-lookup">
      <h3>Reverse Lookup</h3>
      <p>
        If you have an anime's URL of a specific platform,
        such as <a target="_blank" href="https://kitsu.io">Kitsu</a>,
        you can use the following search feature to get the unique IRI of that anime.
        For example, paste Kitsu's URL for the anime 'One Piece' <a target="_blank" href="https://kitsu.io/anime/one-piece">https://kitsu.io/anime/one-piece</a>
        in the box below and hit 'Search'.
      </p>
      <div>
        <form id="search">
          <input id="url" type="url" name="url" placeholder="https://kitsu.io/anime/one-piece" autofocus required>
          <input type="submit" value="Search">
        </form>
      </div>
      <div id="result" class="hidden">
        <p>
          The anime '<span id="title-anime"></span>' has the unique IRI <a id="foundIRI"></a>.
        </p>
      </div>
      <div id="no-result" class="hidden">
        <p>
          Sorry, no anime was found for the URL <a target="_blank" id="sorry-url"></a>.
        </p>
      </div>
    </div>
  </div>
</div>

<script>
  document.querySelector("#search").addEventListener("submit", function(e){
    document.querySelector("#result").classList.add('hidden');
    document.querySelector("#no-result").classList.add('hidden');

    e.preventDefault();
    let url = document.querySelector("#url").value;
    console.log(url);

    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
      if (this.readyState === 4 && this.status === 200) {
        let store = N3.Store();
        let parser = N3.Parser();
        parser.parse(this.responseText, function(error, triple){
          if (triple) {
            store.addTriple(triple.subject, triple.predicate, triple.object);
          } else {
            let result = store.getTriples(null, null, `"${url}"^^http://schema.org/URL`);

            if (result.length > 0) {
              document.querySelector("#result").classList.remove('hidden');
              let a = document.querySelector("#foundIRI");
              a.innerHTML = result[0].subject;
              a.setAttribute('href', result[0].subject);

              let xhttpName = new XMLHttpRequest();

              xhttpName.onreadystatechange = function() {
                if (this.readyState === 4 && this.status === 200) {
                  let store = N3.Store();
                  let parser = N3.Parser();
                  parser.parse(this.responseText, function (error, triple) {
                    if (triple) {
                      store.addTriple(triple.subject, triple.predicate, triple.object);
                    } else {
                      let titles = store.getTriples(result[0].subject, 'http://schema.org/name', null).map(a => a.object);

                      let title;
                      let titleNoLanguage;

                      titles.forEach(n => {
                        if (N3.Util.getLiteralLanguage(n) === 'en') {
                          title = n;
                        }

                        if (N3.Util.getLiteralLanguage(n) === '') {
                          titleNoLanguage = n;
                        }
                      });

                      if (!title && titleNoLanguage) {
                        title = N3.Util.getLiteralValue(titleNoLanguage);
                      } else if (title) {
                        title = N3.Util.getLiteralValue(title);
                      }

                      document.querySelector("#title-anime").innerHTML = title;
                    }
                  });
                }
              };

              xhttpName.open("GET", `https://data.betweenourworlds.org/2017-07?predicate=` + encodeURI('http://schema.org/name') + `&subject=` + encodeURI(encodeURI(result[0].subject)), true);
              xhttpName.setRequestHeader("Accept", "text/turtle");
              xhttpName.send();
            } else {
              document.querySelector("#no-result").classList.remove('hidden');
              let a = document.querySelector("#sorry-url");
              a.innerHTML = url
              a.setAttribute('href', url);
            }
          }
        });
      }
    };

    xhttp.open("GET", `https://data.betweenourworlds.org/2017-07?predicate=` + encodeURI('http://schema.org/mainEntityOfPage') + `&object=` + encodeURI(`"${url}"^^http://schema.org/URL`), true);
    xhttp.setRequestHeader("Accept", "text/turtle");
    xhttp.send();
  });
</script>
